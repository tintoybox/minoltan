<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼ˆå®Œå…¨å®‰å…¨ç‰ˆãƒ»ã‚¹ãƒãƒ›å›ºå®šï¼‹å¤œé–“ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼‰</title>
<meta name="description" content="ã‚¹ãƒãƒ›æœ€é©åŒ–ãƒ»å¤œé–“ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œãƒ»å®‰å…¨ãªscriptã‚¿ã‚°ä»˜ãJSON-LDå‡ºåŠ›ã€‚ImageObjectã¨BlogPostingã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã€‚">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f8fafc;--text:#111;--card:#fff;--border:#e2e8f0;
  --accent:#2563eb;--danger:#dc2626;
  --code-bg:#1e293b;--code-text:#e2e8f0;
}
body.dark{
  --bg:#0f172a;--text:#e2e8f0;--card:#1e293b;--border:#334155;
  --accent:#3b82f6;--danger:#ef4444;--code-bg:#0f172a;--code-text:#e2e8f0;
}
body{
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
  background:var(--bg);color:var(--text);
  padding:16px;margin:0;max-width:1000px;
  transition:background 0.3s,color 0.3s;
}
h1{font-size:20px;margin-bottom:10px}
button,input,select,textarea{font-family:inherit}
button{
  background:var(--accent);color:#fff;border:none;
  padding:8px 12px;border-radius:6px;cursor:pointer;
}
button.ghost{background:var(--card);border:1px solid var(--accent);color:var(--accent)}
button.danger{background:var(--danger);color:#fff}
button.theme-toggle{margin-left:auto}
.card{
  background:var(--card);border:1px solid var(--border);
  border-radius:8px;padding:12px;margin-bottom:12px;
  box-shadow:0 1px 3px rgba(0,0,0,0.05);
}
.controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;align-items:center;}
@media(max-width:768px){
  .controls{
    position:fixed;top:0;left:0;right:0;z-index:1000;
    background:var(--card);border-bottom:1px solid var(--border);
    box-shadow:0 2px 4px rgba(0,0,0,0.1);padding:8px;overflow-x:auto;
  }
  body{padding-top:100px;}
}
pre{
  background:var(--code-bg);color:var(--code-text);
  padding:10px;border-radius:6px;overflow:auto;max-height:400px;font-size:13px;
}
label{display:block;font-size:14px;margin-top:6px}
input[type=text],input[type=date],textarea,select{
  width:100%;max-width:300px;
  padding:6px;border:1px solid var(--border);
  border-radius:6px;margin-top:3px;background:var(--card);color:var(--text);
}
textarea{resize:vertical;min-height:80px}
.photo-card{position:relative;width:100%;max-width:340px}
.remove-icon{position:absolute;top:6px;right:8px;background:transparent;color:var(--danger);border:none;font-size:18px;cursor:pointer}
.status{font-size:13px;padding:6px;border-radius:6px}
.status.ok{background:#dcfce7;color:#166534}
.status.warn{background:#fef9c3;color:#854d0e}
.small{font-size:13px;color:#64748b}
.grid{display:flex;flex-direction:column;gap:16px;}
@media(min-width:900px){.grid{flex-direction:row;align-items:flex-start;}aside{width:360px;}}
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
<h1>æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼ˆå®Œå…¨å®‰å…¨ç‰ˆãƒ»ã‚¹ãƒãƒ›å›ºå®šï¼‹å¤œé–“ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼‰</h1>

<div class="controls">
  <button id="addTop">ï¼‹ å†™çœŸãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ </button>
  <button id="generateBtn">JSON-LDç”Ÿæˆ</button>
  <button id="copyBtn" class="ghost">JSONã‚³ãƒ”ãƒ¼</button>
  <button id="toggleFormat" class="ghost">ğŸ“ æ•´å½¢ï¼šON</button>
  <button id="themeToggle" class="ghost theme-toggle">ğŸŒ™ å¤œé–“ãƒ¢ãƒ¼ãƒ‰</button>
  <label style="font-size:13px;">CSVèª­è¾¼<input id="csvInput" type="file" accept=".csv,text/csv" style="margin-top:4px;"></label>
</div>

<div class="grid">
  <main>
    <div id="photosContainer"></div>
    <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
      <button id="addBottom" class="ghost">ï¼‹ ãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ ï¼ˆä¸‹éƒ¨ï¼‰</button>
      <button id="clearAll" class="danger">ã™ã¹ã¦å‰Šé™¤</button>
    </div>
  </main>

  <aside>
    <div class="card">
      <h2 style="font-size:16px;margin-bottom:6px;">BlogPostingï¼ˆä»»æ„ï¼‰</h2>
      <label>è¨˜äº‹URLï¼š<input type="text" id="bp_url" placeholder="https://example.com/blog/post"></label>
      <label>è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ï¼š<input type="text" id="bp_headline"></label>
      <label>ä»£è¡¨ç”»åƒURLï¼š<input type="text" id="bp_image"></label>
      <label>è‘—è€…åï¼š<input type="text" id="bp_author" value="Tsuneaki Hiramatsu"></label>
      <label>æŠ•ç¨¿æ—¥ï¼š<input type="date" id="bp_date"></label>
      <label>æœ¬æ–‡ï¼š<textarea id="bp_body"></textarea></label>
    </div>

    <div class="card">
      <h3 style="font-size:15px;">å‡ºåŠ›ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
      <div id="status" class="status">æœªç”Ÿæˆã§ã™ã€‚</div>
      <label style="margin-top:6px;">
        <input type="checkbox" id="includeScript"> &lt;script&gt;ã‚¿ã‚°ã‚’ä»˜ã‘ã‚‹ï¼ˆå®‰å…¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
      </label>
      <details style="margin-top:6px;"><summary>ç”Ÿæˆçµæœã‚’è¡¨ç¤º</summary><pre id="outputPre"></pre></details>
    </div>
  </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const photosContainer=document.getElementById('photosContainer');
  const csvInput=document.getElementById('csvInput');
  const statusEl=document.getElementById('status');
  const outputPre=document.getElementById('outputPre');
  const themeBtn=document.getElementById('themeToggle');
  const formatBtn=document.getElementById('toggleFormat');
  const includeScript=document.getElementById('includeScript');
  let lastGenerated=null,pretty=true;

  // å¤œé–“ãƒ¢ãƒ¼ãƒ‰
  const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
  if(prefersDark)document.body.classList.add('dark');
  themeBtn.onclick=()=>{document.body.classList.toggle('dark');
    themeBtn.textContent=document.body.classList.contains('dark')?'â˜€ï¸ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰':'ğŸŒ™ å¤œé–“ãƒ¢ãƒ¼ãƒ‰';};

  // JSONæ•´å½¢åˆ‡æ›¿
  formatBtn.onclick=()=>{pretty=!pretty;
    formatBtn.textContent=pretty?"ğŸ“ æ•´å½¢ï¼šON":"ğŸ“ æ•´å½¢ï¼šOFF";
    if(lastGenerated)renderOutput(lastGenerated);};

  const uid=()=>crypto.randomUUID();
  const updateStatus=(msg,ok=true)=>{statusEl.textContent=msg;statusEl.className="status "+(ok?"ok":"warn");};

  function createPhotoCard(prefill={}){
    const id=uid();
    const c=document.createElement('div');
    c.className='card photo-card';
    c.dataset.id=id;
    c.innerHTML=`
      <button class="remove-icon" title="å‰Šé™¤">âœ•</button>
      <label>ã‚¿ã‚¤ãƒˆãƒ«ï¼š<input type="text" id="imageTitle_${id}" value="${prefill.imageTitle||''}"></label>
      <label>èª¬æ˜æ–‡ï¼š<textarea id="caption_${id}">${prefill.caption||''}</textarea></label>
      <label>ç”»åƒURLï¼š<input type="text" id="contentUrl_${id}" value="${prefill.contentUrl||''}"></label>
      <label>æ’®å½±è€…åï¼š<input type="text" id="creator_${id}" value="${prefill.creator||''}"></label>
      <label>æ’®å½±æ—¥ï¼š<input type="date" id="date_${id}" value="${prefill.datePublished||''}"></label>
      <label>æ’®å½±åœ°åï¼š<input type="text" id="locationName_${id}" value="${prefill.locationName||''}"></label>
      <label>ç·¯åº¦ï¼š<input type="text" id="latitude_${id}" value="${prefill.latitude||''}"></label>
      <label>çµŒåº¦ï¼š<input type="text" id="longitude_${id}" value="${prefill.longitude||''}"></label>
      <label>å¸‚åŒºç”ºæ‘ï¼š<input type="text" id="locality_${id}" value="${prefill.locality||''}"></label>
      <label>éƒ½é“åºœçœŒï¼š<input type="text" id="region_${id}" value="${prefill.region||''}"></label>`;
    c.querySelector('.remove-icon').onclick=()=>{c.remove();updateStatus("å‰Šé™¤ã—ã¾ã—ãŸ");};
    photosContainer.appendChild(c);
  }

  document.getElementById('addTop').onclick=()=>{createPhotoCard();updateStatus("ãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ ");};
  document.getElementById('addBottom').onclick=()=>{createPhotoCard();updateStatus("ãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ ï¼ˆä¸‹ï¼‰");};
  document.getElementById('clearAll').onclick=()=>{if(confirm("å…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){photosContainer.innerHTML='';updateStatus("å…¨å‰Šé™¤ã—ã¾ã—ãŸ");}};
  csvInput.addEventListener('change',e=>{
    const f=e.target.files[0];if(!f)return;
    Papa.parse(f,{header:true,complete:r=>{r.data.forEach(d=>createPhotoCard(d));updateStatus(r.data.length+"ä»¶èª­ã¿è¾¼ã¿");}});
  });

  function collectImages(){
    const imgs=[];
    photosContainer.querySelectorAll('.photo-card').forEach(card=>{
      const id=card.dataset.id;
      const g=k=>document.getElementById(k+'_'+id)?.value.trim();
      imgs.push({
        "@type":"ImageObject",
        name:g('imageTitle'),caption:g('caption'),
        contentUrl:g('contentUrl'),
        creator:g('creator')?{"@type":"Person","name":g('creator')}:undefined,
        datePublished:g('date'),
        locationCreated:{
          "@type":"Place",name:g('locationName'),
          geo:{"@type":"GeoCoordinates","latitude":g('latitude'),"longitude":g('longitude')},
          address:{"@type":"PostalAddress","addressLocality":g('locality'),"addressRegion":g('region'),"addressCountry":"JP"}
        }
      });
    });
    return imgs;
  }

  function renderOutput(data){
    let json=JSON.stringify(data,null,pretty?2:0);
    json=json.replace(/<\/script>/gi,"<\\/script>"); // â† å®‰å…¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    outputPre.textContent=includeScript.checked?
`<script type="application/ld+json">
${json}
</script>`:json;
  }

  document.getElementById('generateBtn').onclick=()=>{
    const imgs=collectImages();
    const bp={
      "@type":"BlogPosting",
      headline:document.getElementById('bp_headline').value.trim(),
      image:imgs[0]?.contentUrl,
      author:{"@type":"Person","name":document.getElementById('bp_author').value.trim()},
      datePublished:document.getElementById('bp_date').value,
      articleBody:document.getElementById('bp_body').value.trim(),
      url:document.getElementById('bp_url').value.trim()
    };
    const out=[bp,...imgs]; out[0]["@context"]="https://schema.org";
    lastGenerated=out;
    renderOutput(out);
    updateStatus("JSON-LDã‚’ç”Ÿæˆã—ã¾ã—ãŸ");
  };

  document.getElementById('copyBtn').onclick=async()=>{
    if(!lastGenerated)return alert("å…ˆã«ç”Ÿæˆã—ã¦ãã ã•ã„");
    let json=JSON.stringify(lastGenerated,null,pretty?2:0);
    json=json.replace(/<\/script>/gi,"<\\/script>");
    const text=includeScript.checked?`<script type="application/ld+json">\n${json}\n</script>`:json;
    await navigator.clipboard.writeText(text);
    updateStatus("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
  };
});
</script>
</body>
</html>
